<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Overlay</title>

    <link rel="stylesheet" href="overlay.css">

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        function setMapScore (team, format, score) {
            if (format != 'bo5') {
                let i = score;
                while (i > 0) {
                    document.getElementById('mp'+team+i).setAttribute("fill", "");
                    i--;
                }
            } else {
                let i = score;
                while (i > 0) {
                    document.getElementById('mp'+team+(i-1)).setAttribute("fill", "");
                    i--;
                }

                let j = 2;
                while (j >= score) {
                    document.getElementById('mp'+team+j).removeAttribute("fill");
                    j--;
                }
            }
            return;
        }

        function updateOverlay(state){
            switch (state.format) {
                case "bo1":
                    document.getElementById('map-points').classList = "bo1"
                    break;
                case "bo3":
                    document.getElementById('map-points').classList = "bo3"
                    break;
                case "bo5":
                    document.getElementById('map-points').classList = "bo5"
                    break;
            }

            switch (state.half) {
                case "1":
                    document.getElementById('nameplateL').classList = "ct"
                    document.getElementById('nameplateR').classList = "t"
                    break;
                case "2":
                    document.getElementById('nameplateL').classList = "t"
                    document.getElementById('nameplateR').classList = "ct"
                    break;
            }

            document.getElementById('abbrL').innerHTML = state.abbrL;
            document.getElementById('logoL').style = `content: url("${state.logoL}")`;
            setMapScore('L', state.format, state.scoreL);

            document.getElementById('abbrR').innerHTML = state.abbrR;
            document.getElementById('logoR').style = `content: url("${state.logoR}")`;
            setMapScore('R', state.format, state.scoreR);
        }

        // Set up the overlay based on the server's state
        socket.on('initialize-overlay', (state) => {
            updateOverlay(state);
        });

        // Listen for updates from admin
        socket.on('update-overlay', (data) => {
            updateOverlay(data);
            /* switch (data.action) {
                case 'change-color':
                    document.body.style.backgroundColor = data.value;
                    console.log(`Changing color to: ${data.value}`);
                    break;

                case 'update-text':
                    document.getElementById(data.target).innerText = data.value;
                    console.log(`Updating text to: ${data.value}`);
                    break;

                case 'update-image':
                    document.getElementById(data.target).style = `content: url("${data.value}")`;
                    console.log(`Updating ${data.target} to: ${data.value}`);
                    break;
                case 'apply-format':
                    switch (data.value) {
                        case "bo1":
                            document.getElementById('map-points').classList = "bo1"
                            break;
                        case "bo3":
                            document.getElementById('map-points').classList = "bo3"
                            break;
                        case "bo5":
                            document.getElementById('map-points').classList = "bo5"
                            break;
                    }
                    break;

                default:
                    console.log('Unknown action:', data.action);
                    break;
            }*/
        });
    </script>
</head>

<body>
    <div id="overlay-frame">
        <div>
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="55px"
                height="55px" id="logoplateL" style="left: 756px; top: 81px; z-index: 39;">
                <path fill-rule="evenodd" clip-rule="evenodd" fill="rgb(14, 24, 32)"
                    d="M0.0,8 L8,0.0 L47,0.0 L55,8 L55,55 L8,55 L0.0,47 L0.0,8 Z" />
            </svg>
            <img class="toplogo" id="logoL" style="left: 763px; top: 88px;">
            <svg class="ct" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
                width="117px" height="40px" id="nameplateL" style="left: 811px; top: 96px; z-index: 39;">
                <path fill-rule="evenodd" clip-rule="evenodd" 
                    d="M0.0,0.0 L100,0.0 L117,18 L117,40 L0.0,40 L0.0,0.0 Z" />
            </svg>
            <div class="teamAbbr" id="abbrL" style="left: 811px; top: 96px; width: 100px; height: 40px; z-index: 41;">
                FNC</div>
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18px"
                height="40px" style="left: 911px; top: 96px; z-index: 40;">
                <path fill-rule="evenodd" fill="rgb(255, 255, 255)"
                    d="M17.999,39.999 L17.0,39.999 L17.0,18.0 L17.0,18.0 L0.0,0.999 L0.999,0.0 L18.0,17.0 L18.0,18.0 L17.999,39.999 Z" />
            </svg>

            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18px"
                height="40px" style="left: 991px; top: 96px; z-index: 40;">
                <path fill-rule="evenodd" fill="rgb(255, 255, 255)"
                    d="M0.999,18.0 L0.999,39.999 L0.0,39.999 L0.0,18.0 L0.0,17.0 L17.0,0.0 L18.0,0.999 L0.999,18.0 Z" />
            </svg>
            <div class="teamAbbr" id="abbrR" style="left: 1009px; top: 96px; width: 100px; height: 40px; z-index: 41;">
                LOUD</div>
            <svg class="t" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
                width="118px"height="40px" id="nameplateR" style="left: 992px; top:96px">
                <path fill-rule="evenodd" 
                    d="M117,0.0 L17,0.0 L0.10,16.989 L0.0,40 L117,40 L117,0.0 Z" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="55px"
                height="55px" id="logoplateR" style="left: 1109px; top:81px;">
                <path fill-rule="evenodd" fill="rgb(14, 24, 32)"
                    d="M54.999,7.999 L46.999,0.0 L7.999,0.0 L0.0,7.999 L0.0,54.999 L46.999,54.999 L54.999,46.999 L54.999,7.999 Z" />
            </svg>
            <img class="toplogo" id="logoR" style="left: 1116px; top: 88px;">
        </div>
        <div>
            <div id="map-points" class="bo3">
                <img class="diamond" id="mpL2" style="left: 817px; top: 75px;">
                <img class="diamond" id="mpL1" style="left: 835px; top: 75px;">
                <img class="diamond" id="mpL0" style="left: 853px; top: 75px;">

                <img class="diamond" id="mpR0" style="left: 1053px; top: 75px;">
                <img class="diamond" id="mpR1" style="left: 1071px; top: 75px;">
                <img class="diamond" id="mpR2" style="left: 1089px; top: 75px;">
            </div>
        </div>
</body>

</html>